<div class="view-wrapper template-editor-wrapper">
    <nz-page-header (nzBack)="titleBack()" nzBackIcon [nzTitle]="title"></nz-page-header>
    <form nz-form [formGroup]="updateForm" (ngSubmit)="submitForm()">
        <div nz-row>
            <div nz-col nzSpan="12">
                <nz-form-item>
                    <nz-form-control>
                        <nz-input-group [nzPrefix]="prefixName">
                            <input formControlName="templateName" nz-input placeholder="Template Name">
                        </nz-input-group>
                        <nz-form-explain *ngIf="isFormInValid()">
                            Please input the template name!
                        </nz-form-explain>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col class="text-right" nzSpan="12">
                <nz-form-item>
                    <nz-form-control>
                        <button nz-button nzType="primary" [disabled]="isFormInValid()">
                            <i nz-icon type="save"></i> Save
                        </button>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>
    </form>

    <div nz-row nzGutter="16">
        <div nz-col class="gutter-row" nzSpan="18">
            <nz-card class="w-100" nzTitle="Workflow">
                <div class="workflow-container">
                    <div class="process-edit-container">
                        <div *ngIf="this.currentProcess">
                            <h3>
                                <i nz-icon nzType="deployment-unit"></i> {{ currentProcess.type }}
                            </h3>
                            <nz-divider></nz-divider>
                        </div>
                        <ng-template #configContainer></ng-template>
                    </div>
                    <div class="process-list-wrapper">
                        <nz-empty *ngIf="!template || template.processes.length === 0" class="empty-process"
                                  nzNotFoundContent="Drop new process here...">
                        </nz-empty>
                        <div #processList class="process-list" *ngIf="template"
                             cdkDropList (cdkDropListDropped)="dropProcess($event)">
                            <div class="process-box" *ngFor="let process of template.processes" cdkDrag>
                                <div class="process-box-content"
                                     [ngClass]="{ 'process-active': process == currentProcess }">
                                    <span>
                                        {{ process.type }}
                                    </span>
                                    <span>
                                        <span class="process-btn" nz-tooltip nzTitle="Edit"
                                              (click)="editProcess(process)">
                                            <i nz-icon type="edit"></i>
                                        </span>
                                        <span class="process-btn" nz-tooltip nzTitle="Delete"
                                              (click)="deleteProcess(process)">
                                            <i nz-icon type="delete"></i>
                                        </span>
                                    </span>
                                </div>
                                <div class="process-box-joint">&nbsp;</div>
                            </div>
                        </div>
                    </div>
                </div>
            </nz-card>
        </div>
        <div nz-col class="gutter-row" nzSpan="6">
            <nz-card *ngIf="processDefMap" class="process-def-list" nzTitle="Processes">
                <nz-dropdown>
                    <a nz-dropdown> Select process type <i nz-icon type="down"></i> </a>
                    <ul nz-menu nzSelectable>
                        <li nz-menu-item *ngFor="let cat of processCategoryList;" (click)="changeProcessDefList(cat)">
                            <i nz-icon [nzType]="cat.icon" nzTheme="outline"></i>
                            {{ cat.name }}
                        </li>
                    </ul>
                </nz-dropdown>
                <div class="process-category-wrapper">
                    <h4 *ngIf="processCategory">
                        <i nz-icon [nzType]="processCategory.icon" nzTheme="outline"></i> {{ processCategory.name }}
                    </h4>
                    <ul id="test" cdkDropList #processDefSelect *ngIf="processDefList && processDefList.length > 0">
                        <li *ngFor="let def of processDefList;">
                            <span>{{ def.type }}</span>
                            <i nz-icon nzType="question-circle" nzTheme="outline"
                                nz-tooltip [nzTitle]="def.description"></i>
                        </li>
                    </ul>
                    <nz-empty *ngIf="!processDefList || processDefList.length === 0"></nz-empty>
                </div>
            </nz-card>
        </div>
    </div>
</div>

<ng-template #prefixName><i nz-icon type="tag"></i></ng-template>
